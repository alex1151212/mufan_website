{"ast":null,"code":"var _jsxFileName = \"D:\\\\FASTAPI_\\\\mufan_\\\\frontend\\\\src\\\\components\\\\Login.js\",\n    _s = $RefreshSig$();\n\nimport { useRef, useState, useEffect } from 'react';\nimport useAuth from '../hooks/useAuth';\nimport { Link, useNavigate, useLocation } from 'react-router-dom';\nimport useLocalStorage from '../hooks/useLocalStorage';\nimport axios from '../api/axios';\nimport useInput from '../hooks/useInput';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst LOGIN_URL = '/login';\n\nconst Login = () => {\n  _s();\n\n  var _location$state, _location$state$from;\n\n  const {\n    setAuth,\n    persist,\n    setPersist\n  } = useAuth();\n  const navigate = useNavigate();\n  const location = useLocation();\n  const from = ((_location$state = location.state) === null || _location$state === void 0 ? void 0 : (_location$state$from = _location$state.from) === null || _location$state$from === void 0 ? void 0 : _location$state$from.pathname) || \"/\";\n  const userRef = useRef();\n  const errRef = useRef();\n  const [user, resetUser, userAttribs] = useInput('user', \"123\"); //useState('');\n\n  const [pwd, setPwd] = useState('');\n  const [errMsg, setErrMsg] = useState('');\n  useEffect(() => {\n    userRef.current.focus();\n  }, []);\n  useEffect(() => {\n    setErrMsg('');\n  }, [user, pwd]);\n\n  const handleSubmit = async e => {\n    e.preventDefault();\n\n    try {\n      var _response$data, _response$data2;\n\n      const response = await axios.post(LOGIN_URL, JSON.stringify(`grant_type=&username=${user}&password=${pwd}&scope=&client_id=&client_secret=`), {\n        header: {\n          'Content-Type': 'application/x-www-form-urlencoded'\n        },\n        withCredentials: true\n      });\n      console.log(JSON.stringify(response === null || response === void 0 ? void 0 : response.data)); //console.log(JSON.stringify(response));\n\n      const accessToken = response === null || response === void 0 ? void 0 : (_response$data = response.data) === null || _response$data === void 0 ? void 0 : _response$data.accessToken;\n      const roles = response === null || response === void 0 ? void 0 : (_response$data2 = response.data) === null || _response$data2 === void 0 ? void 0 : _response$data2.roles;\n      setAuth({\n        user,\n        pwd,\n        roles,\n        accessToken\n      }); // setUser('');\n\n      resetUser();\n      setPwd('');\n      navigate(from, {\n        replace: true\n      });\n    } catch (err) {\n      var _err$response, _err$response2;\n\n      if (!(err !== null && err !== void 0 && err.response)) {\n        setErrMsg('No Server Response');\n      } else if (((_err$response = err.response) === null || _err$response === void 0 ? void 0 : _err$response.status) === 400) {\n        setErrMsg('Missing Username or Password');\n      } else if (((_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : _err$response2.status) === 401) {\n        setErrMsg('Unauthorized');\n      } else {\n        setErrMsg('Login Failed');\n      }\n\n      errRef.current.focus();\n    }\n  };\n\n  const togglePersist = () => {\n    setPersist(prev => !prev);\n  };\n\n  useEffect(() => {\n    localStorage.setItem(\"persist\", persist);\n  }, [persist]);\n  return /*#__PURE__*/_jsxDEV(\"section\", {\n    children: [/*#__PURE__*/_jsxDEV(\"p\", {\n      ref: errRef,\n      className: errMsg ? \"errmsg\" : \"offscreen\",\n      \"aria-live\": \"assertive\",\n      children: errMsg\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n      children: \"Sign In\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: handleSubmit,\n      children: [/*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"username\",\n        children: \"Username:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 77,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        id: \"username\",\n        ref: userRef,\n        autoComplete: \"off\",\n        ...userAttribs,\n        required: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 78,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"password\",\n        children: \"Password:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 87,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"password\",\n        id: \"password\",\n        onChange: e => setPwd(e.target.value),\n        value: pwd,\n        required: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 88,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        children: \"Sign In\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"persistCheck\",\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"checkbox\",\n          id: \"persist\",\n          onChange: togglePersist,\n          checked: persist\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 97,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"persist\",\n          children: \"Trust This Device\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 102,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 96,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: [\"Need an Account?\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 33\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"line\",\n        children: /*#__PURE__*/_jsxDEV(Link, {\n          to: \"/register\",\n          children: \"Sign Up\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 108,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 73,\n    columnNumber: 9\n  }, this);\n};\n\n_s(Login, \"8Up6qTvsT1HoLpriOdMHVkKmBhw=\", false, function () {\n  return [useAuth, useNavigate, useLocation, useInput];\n});\n\n_c = Login;\nexport default Login;\n\nvar _c;\n\n$RefreshReg$(_c, \"Login\");","map":{"version":3,"sources":["D:/FASTAPI_/mufan_/frontend/src/components/Login.js"],"names":["useRef","useState","useEffect","useAuth","Link","useNavigate","useLocation","useLocalStorage","axios","useInput","LOGIN_URL","Login","setAuth","persist","setPersist","navigate","location","from","state","pathname","userRef","errRef","user","resetUser","userAttribs","pwd","setPwd","errMsg","setErrMsg","current","focus","handleSubmit","e","preventDefault","response","post","JSON","stringify","header","withCredentials","console","log","data","accessToken","roles","replace","err","status","togglePersist","prev","localStorage","setItem","target","value"],"mappings":"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","sourcesContent":["import { useRef, useState, useEffect } from 'react';\r\nimport useAuth from '../hooks/useAuth';\r\nimport { Link, useNavigate, useLocation } from 'react-router-dom';\r\nimport useLocalStorage from '../hooks/useLocalStorage';\r\nimport axios from '../api/axios';\r\nimport useInput from '../hooks/useInput'\r\nconst LOGIN_URL = '/login';\r\n\r\nconst Login = () => {\r\n    const { setAuth ,persist,setPersist } = useAuth();\r\n\r\n    const navigate = useNavigate();\r\n    const location = useLocation();\r\n    const from = location.state?.from?.pathname || \"/\";\r\n\r\n    const userRef = useRef();\r\n    const errRef = useRef();\r\n\r\n    const [user, resetUser,userAttribs] = useInput('user',\"123\");//useState('');\r\n    const [pwd, setPwd] = useState('');\r\n    const [errMsg, setErrMsg] = useState('');\r\n\r\n    useEffect(() => {\r\n        userRef.current.focus();\r\n    }, [])\r\n\r\n    useEffect(() => {\r\n        setErrMsg('');\r\n    }, [user, pwd])\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n\r\n        try {\r\n            const response = await axios.post(LOGIN_URL,\r\n                JSON.stringify(`grant_type=&username=${user}&password=${pwd}&scope=&client_id=&client_secret=`),\r\n                {\r\n                    header: { 'Content-Type': 'application/x-www-form-urlencoded' },\r\n                    withCredentials: true\r\n                }\r\n            );\r\n            console.log(JSON.stringify(response?.data));\r\n            //console.log(JSON.stringify(response));\r\n            const accessToken = response?.data?.accessToken;\r\n            const roles = response?.data?.roles;\r\n            setAuth({ user, pwd, roles, accessToken });\r\n            // setUser('');\r\n            resetUser();\r\n            setPwd('');\r\n            navigate(from, { replace: true });\r\n        } catch (err) {\r\n            if (!err?.response) {\r\n                setErrMsg('No Server Response');\r\n            } else if (err.response?.status === 400) {\r\n                setErrMsg('Missing Username or Password');\r\n            } else if (err.response?.status === 401) {\r\n                setErrMsg('Unauthorized');\r\n            } else {\r\n                setErrMsg('Login Failed');\r\n            }\r\n            errRef.current.focus();\r\n        }\r\n    }\r\nconst togglePersist = () =>{\r\n    setPersist(prev=> !prev);\r\n}\r\nuseEffect(()=>{\r\n    localStorage.setItem(\"persist\",persist)\r\n},[persist])\r\n\r\n    return (\r\n\r\n        <section>\r\n            <p ref={errRef} className={errMsg ? \"errmsg\" : \"offscreen\"} aria-live=\"assertive\">{errMsg}</p>\r\n            <h1>Sign In</h1>\r\n            <form onSubmit={handleSubmit}>\r\n                <label htmlFor=\"username\">Username:</label>\r\n                <input\r\n                    type=\"text\"\r\n                    id=\"username\"\r\n                    ref={userRef}\r\n                    autoComplete=\"off\"\r\n                    {...userAttribs}\r\n                    required\r\n                />\r\n\r\n                <label htmlFor=\"password\">Password:</label>\r\n                <input\r\n                    type=\"password\"\r\n                    id=\"password\"\r\n                    onChange={(e) => setPwd(e.target.value)}\r\n                    value={pwd}\r\n                    required\r\n                />\r\n                <button>Sign In</button>\r\n                <div className='persistCheck'>\r\n                    <input type=\"checkbox\"\r\n                            id = \"persist\"\r\n                            onChange={togglePersist}\r\n                            checked={persist}\r\n                    />\r\n                    <label htmlFor='persist'>Trust This Device</label>\r\n                </div>\r\n            </form>\r\n            <p>\r\n                Need an Account?<br />\r\n                <span className=\"line\">\r\n                    <Link to=\"/register\">Sign Up</Link>\r\n                </span>\r\n            </p>\r\n        </section>\r\n\r\n    )\r\n}\r\n\r\nexport default Login\r\n\r\n\r\n\r\n"]},"metadata":{},"sourceType":"module"}